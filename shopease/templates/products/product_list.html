{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }} - ShopEase{% endblock %}

{% block content %}

<!-- Breadcrumb Navigation -->
<section class="breadcrumb-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                {% for crumb in breadcrumbs %}
                {% if crumb.url %}
                <li class="breadcrumb-item">
                    <a href="{{ crumb.url }}">{{ crumb.name }}</a>
                </li>
                {% else %}
                <li class="breadcrumb-item active" aria-current="page">
                    {{ crumb.name }}
                </li>
                {% endif %}
                {% endfor %}
            </ol>
        </nav>
    </div>
</section>

<!-- Products Header -->
<section class="products-header">
    <div class="container">
        <div class="header-content">
            <div class="header-text">
                <h1>{{ page_title }}</h1>
                <p class="product-count">{{ total_products }} product{{ total_products|pluralize }} found</p>
            </div>

            <!-- Sort Dropdown -->
            <div class="sort-dropdown">
                <label for="sort-select">Sort by:</label>
                <select id="sort-select" class="sort-select" onchange="sortProducts(this.value)">
                    <option value="newest" {% if current_sort=='newest' %}selected{% endif %}>
                        Newest
                    </option>
                    <option value="price_low" {% if current_sort=='price_low' %}selected{% endif %}>
                        Price: Low to High
                    </option>
                    <option value="price_high" {% if current_sort=='price_high' %}selected{% endif %}>
                        Price: High to Low
                    </option>
                    <option value="name" {% if current_sort=='name' %}selected{% endif %}>
                        Name: A-Z
                    </option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Products Grid -->
<section class="products-section">
    <div class="container">
        {% if products %}
        <div class="products-grid">
            {% for product in products %}
            <div class="product-card">
                <!-- Product Image -->
                <div class="product-image">
                    <a href="{% url 'products:detail' product.slug %}">
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                    </a>

                    {% if product.is_on_sale %}
                    <span class="product-badge sale">
                        Save {{ product.get_discount_percentage }}%
                    </span>
                    {% endif %}

                    <div class="product-actions">
                        <button class="action-btn wishlist-btn" data-product-id="{{ product.id }}"
                            title="Add to Wishlist">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path
                                    d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <div class="product-category">
                        {{ product.category.name }}
                    </div>

                    <h3 class="product-name">
                        <a href="{% url 'products:detail' product.slug %}">
                            {{ product.name|truncatewords:10 }}
                        </a>
                    </h3>

                    <div class="product-rating">
                        <div class="stars">
                            <span style="color: #f39c12;">★★★★★</span>
                        </div>
                        <span class="rating-text">({{ product.get_review_count }})</span>
                    </div>

                    <div class="product-price">
                        {% if product.is_on_sale %}
                        <span class="price-original">${{ product.price }}</span>
                        <span class="price-sale">${{ product.sale_price }}</span>
                        {% else %}
                        <span class="price-current">${{ product.price }}</span>
                        {% endif %}
                    </div>

                    <button class="btn-add-cart" data-product-id="{{ product.id }}"
                        onclick="addToCart({{ product.id }}, '{{ product.name|escapejs }}')">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" />
                        </svg>
                        Add to Cart
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.has_other_pages %}
        <nav class="pagination-nav" aria-label="Page navigation">
            <ul class="pagination">
                {% if products.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1{% if current_sort %}&sort={{ current_sort }}{% endif %}">
                        First
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ products.previous_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}">
                        Previous
                    </a>
                </li>
                {% endif %}

                <li class="page-item active">
                    <span class="page-link">
                        Page {{ products.number }} of {{ products.paginator.num_pages }}
                    </span>
                </li>

                {% if products.has_next %}
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ products.next_page_number }}{% if current_sort %}&sort={{ current_sort }}{% endif %}">
                        Next
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ products.paginator.num_pages }}{% if current_sort %}&sort={{ current_sort }}{% endif %}">
                        Last
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" />
                <line x1="12" y1="8" x2="12" y2="12" />
                <line x1="12" y1="16" x2="12.01" y2="16" />
            </svg>
            <h3>No products found</h3>
            <p>Check back later for new arrivals!</p>
            <a href="{% url 'home' %}" class="btn btn-primary">
                Back to Home
            </a>
        </div>
        {% endif %}
    </div>
</section>

{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<style>
    /* Breadcrumb */
    .breadcrumb-section {
        background: #f8f9fa;
        padding: 1rem 0;
    }

    .breadcrumb {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        flex-wrap: wrap;
    }

    .breadcrumb-item {
        font-size: 0.875rem;
    }

    .breadcrumb-item+.breadcrumb-item::before {
        content: '›';
        padding: 0 0.5rem;
        color: #6b7280;
    }

    .breadcrumb-item a {
        color: #0f4c5c;
        text-decoration: none;
    }

    .breadcrumb-item a:hover {
        text-decoration: underline;
    }

    .breadcrumb-item.active {
        color: #6b7280;
    }

    /* Products Header */
    .products-header {
        padding: 2rem 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .header-text h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .product-count {
        color: #6b7280;
        font-size: 0.875rem;
    }

    .sort-dropdown {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .sort-dropdown label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #374151;
    }

    .sort-select {
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        background: white;
        cursor: pointer;
    }

    /* Pagination */
    .pagination-nav {
        margin-top: 3rem;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        list-style: none;
        padding: 0;
    }

    .page-item .page-link {
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        color: #374151;
        text-decoration: none;
        transition: all 0.2s;
    }

    .page-item .page-link:hover {
        background: #f3f4f6;
        border-color: #0f4c5c;
    }

    .page-item.active .page-link {
        background: #0f4c5c;
        color: white;
        border-color: #0f4c5c;
        pointer-events: none;
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }

    .empty-state svg {
        color: #9ca3af;
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: #6b7280;
        margin-bottom: 2rem;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function sortProducts(sortValue) {
        // Get current URL
        const url = new URL(window.location);

        // Update sort parameter
        url.searchParams.set('sort', sortValue);

        // Navigate to new URL
        window.location.href = url.toString();
    }
</script>
{% endblock %}