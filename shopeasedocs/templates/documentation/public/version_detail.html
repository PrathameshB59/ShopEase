{% extends 'base.html' %}
{% load static %}

{% block title %}Version {{ version.version_number }} - Release Notes - ShopEase Documentation{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'documentation/css/docs.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
{% endblock %}

{% block content %}
<div class="container-fluid bg-primary text-white py-4">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-transparent text-white mb-2">
                <li class="breadcrumb-item">
                    <a href="{% url 'documentation:doc_home' %}" class="text-white">Home</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url 'documentation:version_list' %}" class="text-white">Versions</a>
                </li>
                <li class="breadcrumb-item active text-white" aria-current="page">{{ version.version_number }}</li>
            </ol>
        </nav>
        <h1><i class="bi bi-tag me-2"></i>Version {{ version.version_number }}</h1>
        <div class="d-flex gap-3 mt-3 flex-wrap">
            <span class="badge bg-light text-dark">
                {{ version.get_version_type_display }} Release
            </span>
            {% if is_current %}
            <span class="badge bg-warning text-dark">
                <i class="bi bi-star-fill"></i> Current Version
            </span>
            {% endif %}
            {% if version.is_stable %}
            <span class="badge bg-success">Stable</span>
            {% endif %}
            <span class="text-white-50">
                <i class="bi bi-calendar"></i> Released {{ version.release_date|date:"F d, Y" }}
            </span>
            <span class="text-white-50">
                <i class="bi bi-clock"></i> {{ version.release_date|timesince }} ago
            </span>
        </div>
    </div>
</div>

<div class="container my-5">
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-file-text me-2"></i>Release Notes</h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.release_notes|safe }}
                    </div>
                </div>
            </div>

            {% if version.features %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-plus-circle me-2"></i>New Features</h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.features|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if version.fixes %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="bi bi-bug me-2"></i>Bug Fixes</h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.fixes|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if version.improvements %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-arrow-up-circle me-2"></i>Improvements</h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.improvements|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if version.breaking_changes %}
            <div class="card shadow-sm mb-4 border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Breaking Changes</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning mb-3">
                        <strong>Important:</strong> This release contains breaking changes that may require updates to your integration.
                    </div>
                    <div class="doc-content">
                        {{ version.breaking_changes|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if version.migration_guide %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-arrow-right-circle me-2"></i>Migration Guide</h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.migration_guide|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            {% if version.known_issues %}
            <div class="card shadow-sm mb-4 border-danger">
                <div class="card-header bg-light text-dark border-bottom border-danger">
                    <h5 class="mb-0 text-danger">
                        <i class="bi bi-exclamation-octagon me-2"></i>Known Issues
                    </h5>
                </div>
                <div class="card-body">
                    <div class="doc-content">
                        {{ version.known_issues|safe }}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm mb-4 sticky-top" style="top: 1rem;">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0"><i class="bi bi-info-circle me-2"></i>Version Information</h6>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-6">Version:</dt>
                        <dd class="col-sm-6"><strong>{{ version.version_number }}</strong></dd>

                        <dt class="col-sm-6">Type:</dt>
                        <dd class="col-sm-6">
                            <span class="badge bg-{{ version.get_version_type_color }}">
                                {{ version.get_version_type_display }}
                            </span>
                        </dd>

                        <dt class="col-sm-6">Released:</dt>
                        <dd class="col-sm-6">{{ version.release_date|date:"M d, Y" }}</dd>

                        <dt class="col-sm-6">Status:</dt>
                        <dd class="col-sm-6">
                            {% if is_current %}
                            <span class="badge bg-success">Current</span>
                            {% else %}
                            <span class="badge bg-secondary">Archived</span>
                            {% endif %}
                        </dd>

                        {% if version.is_stable %}
                        <dt class="col-sm-6">Stability:</dt>
                        <dd class="col-sm-6">
                            <span class="badge bg-success">Stable</span>
                        </dd>
                        {% endif %}
                    </dl>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">
                    <h6 class="mb-0"><i class="bi bi-list-check me-2"></i>What's Included</h6>
                </div>
                <div class="list-group list-group-flush">
                    {% if version.features %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-plus-circle text-success me-2"></i>New Features</span>
                        <span class="badge bg-success rounded-pill">{{ version.features|split:','|length }}</span>
                    </div>
                    {% endif %}
                    {% if version.fixes %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-bug text-danger me-2"></i>Bug Fixes</span>
                        <span class="badge bg-danger rounded-pill">{{ version.fixes|split:','|length }}</span>
                    </div>
                    {% endif %}
                    {% if version.improvements %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-arrow-up-circle text-info me-2"></i>Improvements</span>
                        <span class="badge bg-info rounded-pill">{{ version.improvements|split:','|length }}</span>
                    </div>
                    {% endif %}
                    {% if version.breaking_changes %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-exclamation-triangle text-warning me-2"></i>Breaking Changes</span>
                        <span class="badge bg-warning text-dark rounded-pill">Yes</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm bg-light border-0">
                <div class="card-body">
                    <h6 class="mb-3">Version Navigation</h6>
                    <div class="d-grid gap-2">
                        {% if next_version %}
                        <a href="{% url 'documentation:version_detail' next_version.version_number %}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-arrow-up"></i> Newer: {{ next_version.version_number }}
                        </a>
                        {% else %}
                        <button class="btn btn-sm btn-outline-secondary" disabled>
                            <i class="bi bi-arrow-up"></i> No Newer Version
                        </button>
                        {% endif %}

                        <a href="{% url 'documentation:version_list' %}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-list"></i> All Versions
                        </a>

                        {% if previous_version %}
                        <a href="{% url 'documentation:version_detail' previous_version.version_number %}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-arrow-down"></i> Older: {{ previous_version.version_number }}
                        </a>
                        {% else %}
                        <button class="btn btn-sm btn-outline-secondary" disabled>
                            <i class="bi bi-arrow-down"></i> No Older Version
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
<script src="{% static 'documentation/js/docs.js' %}"></script>
<script>
    // Initialize syntax highlighting
    if (typeof Prism !== 'undefined') {
        Prism.highlightAll();
    }
</script>
{% endblock %}
