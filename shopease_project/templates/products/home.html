{% extends 'base.html' %}
{% load static %}

<!-- 
HOME PAGE TEMPLATE
==================
This is the main landing page customers see when they visit the website.

Sections:
1. Hero Banner - Eye-catching welcome message with call-to-action
2. Featured Categories - Shop by category
3. Featured Products - Handpicked products
4. New Arrivals - Latest products
5. Products on Sale - Discounted items
6. Why Choose Us - Trust badges
7. Newsletter - Email subscription
-->

{% block title %}ShopEase - Your Ultimate Shopping Destination{% endblock %}

{% block extra_css %}
<style>
    /* 
    HOME PAGE SPECIFIC STYLES
    ==========================
    Additional CSS for home page sections
    */

    /* HERO SECTION */
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 4rem 0;
        margin-bottom: 3rem;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" fill="rgba(255,255,255,0.1)"></path></svg>') no-repeat;
        background-size: cover;
        opacity: 0.3;
    }

    .hero-content {
        position: relative;
        z-index: 1;
        text-align: center;
        max-width: 800px;
        margin: 0 auto;
    }

    .hero-title {
        font-size: 3.5rem;
        font-weight: 800;
        margin-bottom: 1.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        animation: fadeInUp 0.8s ease;
    }

    .hero-subtitle {
        font-size: 1.5rem;
        margin-bottom: 2rem;
        opacity: 0.95;
        animation: fadeInUp 1s ease;
    }

    .hero-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        animation: fadeInUp 1.2s ease;
    }

    .hero-btn {
        padding: 1rem 2.5rem;
        font-size: 1.125rem;
        font-weight: 600;
        border-radius: 50px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .hero-btn-primary {
        background: white;
        color: #667eea;
    }

    .hero-btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(255, 255, 255, 0.3);
    }

    .hero-btn-outline {
        background: transparent;
        color: white;
        border: 2px solid white;
    }

    .hero-btn-outline:hover {
        background: white;
        color: #667eea;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* SECTION HEADERS */
    .section {
        padding: 3rem 0;
    }

    .section-header {
        text-align: center;
        margin-bottom: 3rem;
    }

    .section-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .section-subtitle {
        font-size: 1.125rem;
        color: #6b7280;
    }

    /* CATEGORY GRID */
    .category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .category-card {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
    }

    .category-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .category-icon {
        font-size: 3rem;
        color: #2563eb;
        margin-bottom: 1rem;
        transition: transform 0.3s ease;
    }

    .category-card:hover .category-icon {
        transform: scale(1.2) rotate(5deg);
    }

    .category-name {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .category-count {
        color: #6b7280;
        font-size: 0.875rem;
    }

    /* PRODUCT GRID */
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .product-card {
        background: white;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        position: relative;
    }

    .product-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    }

    .product-image-wrapper {
        position: relative;
        overflow: hidden;
        padding-top: 100%;
        background: #f3f4f6;
    }

    .product-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .product-image {
        transform: scale(1.1);
    }

    .product-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: #ef4444;
        color: white;
        padding: 0.375rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        z-index: 2;
    }

    .product-badge.sale {
        background: #ef4444;
    }

    .product-badge.new {
        background: #10b981;
    }

    .product-badge.featured {
        background: #f59e0b;
    }

    .product-info {
        padding: 1.5rem;
    }

    .product-category {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 0.5rem;
    }

    .product-name {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.75rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .product-price {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .price-current {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2563eb;
    }

    .price-original {
        font-size: 1rem;
        color: #9ca3af;
        text-decoration: line-through;
    }

    .price-discount {
        background: #fee2e2;
        color: #dc2626;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 700;
    }

    .product-rating {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .stars {
        color: #fbbf24;
    }

    .rating-count {
        color: #6b7280;
        font-size: 0.875rem;
    }

    .product-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-add-cart {
        flex: 1;
        background: #2563eb;
        color: white;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-add-cart:hover {
        background: #1e40af;
        transform: scale(1.02);
    }

    .btn-wishlist {
        background: #f3f4f6;
        color: #6b7280;
        padding: 0.75rem;
        border: none;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-wishlist:hover {
        background: #ef4444;
        color: white;
    }

    /* FEATURES SECTION */
    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }

    .feature-card {
        text-align: center;
        padding: 2rem;
    }

    .feature-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 1.5rem;
    }

    .feature-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .feature-text {
        color: #6b7280;
    }

    /* NEWSLETTER SECTION */
    .newsletter-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 4rem 0;
        text-align: center;
        margin-top: 3rem;
    }

    .newsletter-form {
        max-width: 500px;
        margin: 2rem auto 0;
        display: flex;
        gap: 0.5rem;
    }

    .newsletter-form input {
        flex: 1;
        padding: 1rem 1.5rem;
        border: none;
        border-radius: 50px;
        font-size: 1rem;
    }

    .newsletter-form button {
        background: white;
        color: #667eea;
        padding: 1rem 2rem;
        border: none;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .newsletter-form button:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
    }

    /* VIEW ALL BUTTON */
    .view-all-btn {
        display: block;
        width: fit-content;
        margin: 2rem auto 0;
        padding: 1rem 3rem;
        background: transparent;
        color: #2563eb;
        border: 2px solid #2563eb;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
    }

    .view-all-btn:hover {
        background: #2563eb;
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
    }

    /* EMPTY STATE */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }

    .empty-icon {
        font-size: 5rem;
        color: #d1d5db;
        margin-bottom: 1rem;
    }

    .empty-text {
        color: #6b7280;
        font-size: 1.25rem;
    }

    /* LOADING SKELETON */
    .skeleton {
        background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
        background-size: 200% 100%;
        animation: loading 1.5s ease-in-out infinite;
    }

    @keyframes loading {
        0% {
            background-position: 200% 0;
        }

        100% {
            background-position: -200% 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- 
==========================================================================
HERO SECTION
==========================================================================
Eye-catching banner with call-to-action
-->
<section class="hero-section">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                Welcome to ShopEase
            </h1>
            <p class="hero-subtitle">
                Discover amazing products at unbeatable prices. Shop the latest trends and exclusive deals!
            </p>
            <div class="hero-buttons">
                <a href="{% url 'products:product_list' %}" class="hero-btn hero-btn-primary">
                    <i class="fas fa-shopping-bag"></i>
                    Shop Now
                </a>
                <a href="#featured" class="hero-btn hero-btn-outline">
                    <i class="fas fa-star"></i>
                    View Deals
                </a>
            </div>
        </div>
    </div>
</section>

<!-- 
==========================================================================
FEATURED CATEGORIES
==========================================================================
Shop by category
-->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Shop by Category</h2>
            <p class="section-subtitle">Browse our wide range of product categories</p>
        </div>

        {% if categories %}
        <div class="category-grid">
            {% for category in categories %}
            <a href="{% url 'products:category_detail' slug=category.slug %}" class="category-card">
                <div class="category-icon">
                    <i class="fas fa-box"></i>
                </div>
                <h3 class="category-name">{{ category.name }}</h3>
                <p class="category-count">{{ category.product_count }} Products</p>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-box-open"></i>
            </div>
            <p class="empty-text">No categories available yet. Check back soon!</p>
        </div>
        {% endif %}

        <a href="{% url 'products:product_list' %}" class="view-all-btn">
            View All Categories
            <i class="fas fa-arrow-right"></i>
        </a>
    </div>
</section>

<!-- 
==========================================================================
FEATURED PRODUCTS
==========================================================================
Handpicked products marked as featured by admin
-->
<section class="section" id="featured" style="background: #f9fafb;">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-star" style="color: #f59e0b;"></i>
                Featured Products
            </h2>
            <p class="section-subtitle">Handpicked favorites just for you</p>
        </div>

        {% if featured_products %}
        <div class="product-grid">
            {% for product in featured_products %}
            <div class="product-card">
                <div class="product-image-wrapper">
                    {% if product.get_primary_image %}
                    <img src="{{ product.get_primary_image.image.url }}" alt="{{ product.name }}" class="product-image">
                    {% else %}
                    <img src="https://via.placeholder.com/400x400?text={{ product.name|truncatewords:2 }}"
                        alt="{{ product.name }}" class="product-image">
                    {% endif %}

                    <span class="product-badge featured">
                        <i class="fas fa-star"></i> Featured
                    </span>
                </div>

                <div class="product-info">
                    <div class="product-category">
                        {{ product.category.name|default:"Uncategorized" }}
                    </div>

                    <h3 class="product-name">
                        <a href="{% url 'products:product_detail' slug=product.slug %}" style="color: inherit;">
                            {{ product.name }}
                        </a>
                    </h3>

                    <div class="product-price">
                        <span class="price-current">${{ product.get_price }}</span>
                        {% if product.is_on_sale %}
                        <span class="price-original">${{ product.price }}</span>
                        <span class="price-discount">
                            {{ product.get_discount_percentage }}% OFF
                        </span>
                        {% endif %}
                    </div>

                    <div class="product-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                            {% if forloop.counter <= product.average_rating %} <i class="fas fa-star"></i>
                                {% else %}
                                <i class="far fa-star"></i>
                                {% endif %}
                                {% endfor %}
                        </div>
                        <span class="rating-count">({{ product.review_count }})</span>
                    </div>

                    <div class="product-actions">
                        <button class="btn-add-cart" onclick="addToCart({{ product.id }})">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                        <button class="btn-wishlist" onclick="addToWishlist({{ product.id }})">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-star"></i>
            </div>
            <p class="empty-text">No featured products available. Check back soon!</p>
        </div>
        {% endif %}

        <a href="{% url 'products:product_list' %}" class="view-all-btn">
            View All Products
            <i class="fas fa-arrow-right"></i>
        </a>
    </div>
</section>

<!-- 
==========================================================================
NEW ARRIVALS
==========================================================================
Latest products added to the store
-->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-fire" style="color: #ef4444;"></i>
                New Arrivals
            </h2>
            <p class="section-subtitle">Fresh products just added to our collection</p>
        </div>

        {% if new_arrivals %}
        <div class="product-grid">
            {% for product in new_arrivals %}
            <div class="product-card">
                <div class="product-image-wrapper">
                    {% if product.get_primary_image %}
                    <img src="{{ product.get_primary_image.image.url }}" alt="{{ product.name }}" class="product-image">
                    {% else %}
                    <img src="https://via.placeholder.com/400x400?text={{ product.name|truncatewords:2 }}"
                        alt="{{ product.name }}" class="product-image">
                    {% endif %}

                    <span class="product-badge new">
                        <i class="fas fa-certificate"></i> New
                    </span>
                </div>

                <div class="product-info">
                    <div class="product-category">
                        {{ product.category.name|default:"Uncategorized" }}
                    </div>

                    <h3 class="product-name">
                        <a href="{% url 'products:product_detail' slug=product.slug %}" style="color: inherit;">
                            {{ product.name }}
                        </a>
                    </h3>

                    <div class="product-price">
                        <span class="price-current">${{ product.get_price }}</span>
                        {% if product.is_on_sale %}
                        <span class="price-original">${{ product.price }}</span>
                        <span class="price-discount">
                            {{ product.get_discount_percentage }}% OFF
                        </span>
                        {% endif %}
                    </div>

                    <div class="product-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                            {% if forloop.counter <= product.average_rating %} <i class="fas fa-star"></i>
                                {% else %}
                                <i class="far fa-star"></i>
                                {% endif %}
                                {% endfor %}
                        </div>
                        <span class="rating-count">({{ product.review_count }})</span>
                    </div>

                    <div class="product-actions">
                        <button class="btn-add-cart" onclick="addToCart({{ product.id }})">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                        <button class="btn-wishlist" onclick="addToWishlist({{ product.id }})">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-box"></i>
            </div>
            <p class="empty-text">No new arrivals at the moment. Check back soon!</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- 
==========================================================================
PRODUCTS ON SALE
==========================================================================
Products with discounted prices
-->
{% if sale_products %}
<section class="section" style="background: #f9fafb;">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-tag" style="color: #10b981;"></i>
                Hot Deals
            </h2>
            <p class="section-subtitle">Limited time offers - grab them before they're gone!</p>
        </div>

        <div class="product-grid">
            {% for product in sale_products %}
            <div class="product-card">
                <div class="product-image-wrapper">
                    {% if product.get_primary_image %}
                    <img src="{{ product.get_primary_image.image.url }}" alt="{{ product.name }}" class="product-image">
                    {% else %}
                    <img src="https://via.placeholder.com/400x400?text={{ product.name|truncatewords:2 }}"
                        alt="{{ product.name }}" class="product-image">
                    {% endif %}

                    <span class="product-badge sale">
                        <i class="fas fa-fire"></i> {{ product.get_discount_percentage }}% OFF
                    </span>
                </div>

                <div class="product-info">
                    <div class="product-category">
                        {{ product.category.name|default:"Uncategorized" }}
                    </div>

                    <h3 class="product-name">
                        <a href="{% url 'products:product_detail' slug=product.slug %}" style="color: inherit;">
                            {{ product.name }}
                        </a>
                    </h3>

                    <div class="product-price">
                        <span class="price-current">${{ product.get_price }}</span>
                        <span class="price-original">${{ product.price }}</span>
                        <span class="price-discount">
                            {{ product.get_discount_percentage }}% OFF
                        </span>
                    </div>

                    <div class="product-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                            {% if forloop.counter <= product.average_rating %} <i class="fas fa-star"></i>
                                {% else %}
                                <i class="far fa-star"></i>
                                {% endif %}
                                {% endfor %}
                        </div>
                        <span class="rating-count">({{ product.review_count }})</span>
                    </div>

                    <div class="product-actions">
                        <button class="btn-add-cart" onclick="addToCart({{ product.id }})">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                        <button class="btn-wishlist" onclick="addToWishlist({{ product.id }})">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- 
==========================================================================
WHY CHOOSE US
==========================================================================
Trust badges and features
-->
<section class="section">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Why Shop With Us?</h2>
            <p class="section-subtitle">Experience the best online shopping</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shipping-fast"></i>
                </div>
                <h3 class="feature-title">Free Shipping</h3>
                <p class="feature-text">Free delivery on orders over $50</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="feature-title">Secure Payment</h3>
                <p class="feature-text">100% secure payment processing</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-undo-alt"></i>
                </div>
                <h3 class="feature-title">Easy Returns</h3>
                <p class="feature-text">30-day return policy</p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-headset"></i>
                </div>
                <h3 class="feature-title">24/7 Support</h3>
                <p class="feature-text">Dedicated customer service</p>
            </div>
        </div>
    </div>
</section>

<!-- 
==========================================================================
NEWSLETTER SECTION
==========================================================================
Email subscription for offers and updates
-->
<section class="newsletter-section">
    <div class="container">
        <h2 class="section-title" style="color: white;">Subscribe to Our Newsletter</h2>
        <p class="section-subtitle" style="color: rgba(255,255,255,0.9);">
            Get the latest updates on new products and exclusive offers!
        </p>

        <form class="newsletter-form" method="POST" action="#">
            {% csrf_token %}
            <input type="email" name="email" placeholder="Enter your email address" required>
            <button type="submit">
                <i class="fas fa-paper-plane"></i>
                Subscribe
            </button>
        </form>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
    // FETCH PRODUCTS FROM FAKESTORE API
    async function loadProductsFromAPI() {
        try {
            // Fetch products from FakeStore API
            const response = await fetch('https://fakestoreapi.com/products?limit=8');
            const products = await response.json();

            // Render featured products
            renderFeaturedProducts(products.slice(0, 8));

            // Render new arrivals
            renderNewArrivals(products.slice(0, 8));

            // Render sale products (simulate sale)
            const saleProducts = products.slice(0, 8).map(p => ({
                ...p,
                originalPrice: p.price,
                price: (p.price * 0.8).toFixed(2),
                discount: 20
            }));
            renderSaleProducts(saleProducts);

            // Load categories
            loadCategories();

        } catch (error) {
            console.error('Error loading products:', error);
        }
    }

    // RENDER FEATURED PRODUCTS
    function renderFeaturedProducts(products) {
        const container = document.querySelector('#featured .product-grid');
        if (!container) return;

        container.innerHTML = products.map(product => createProductCard(product, 'featured')).join('');
    }

    // RENDER NEW ARRIVALS
    function renderNewArrivals(products) {
        const section = document.querySelectorAll('.section')[2];
        if (!section) return;

        const container = section.querySelector('.product-grid');
        if (!container) return;

        container.innerHTML = products.map(product => createProductCard(product, 'new')).join('');
    }

    // RENDER SALE PRODUCTS
    function renderSaleProducts(products) {
        const sections = document.querySelectorAll('.section');
        if (sections.length < 4) return;

        const container = sections[3].querySelector('.product-grid');
        if (!container) return;

        container.innerHTML = products.map(product => createProductCard(product, 'sale')).join('');
    }

    // CREATE PRODUCT CARD HTML
    function createProductCard(product, type) {
        const badgeMap = {
            'featured': '<i class="fas fa-star"></i> Featured',
            'new': '<i class="fas fa-certificate"></i> New',
            'sale': `<i class="fas fa-fire"></i> ${product.discount || 20}% OFF`
        };

        const priceHTML = type === 'sale' ? `
        <span class="price-current">$${product.price}</span>
        <span class="price-original">$${product.originalPrice}</span>
        <span class="price-discount">${product.discount}% OFF</span>
    ` : `
        <span class="price-current">$${product.price}</span>
    `;

        return `
        <div class="product-card">
            <div class="product-image-wrapper">
                <img src="${product.image}" alt="${product.title}" class="product-image">
                <span class="product-badge ${type}">${badgeMap[type]}</span>
            </div>
            
            <div class="product-info">
                <div class="product-category">${product.category || 'Uncategorized'}</div>
                
                <h3 class="product-name">
                    <a href="#" style="color: inherit;">${product.title}</a>
                </h3>
                
                <div class="product-price">${priceHTML}</div>
                
                <div class="product-rating">
                    <div class="stars">
                        ${generateStars(product.rating?.rate || 4)}
                    </div>
                    <span class="rating-count">(${product.rating?.count || 0})</span>
                </div>
                
                <div class="product-actions">
                    <button class="btn-add-cart" onclick="addToCart(${product.id}, '${escapeHtml(product.title)}')">
                        <i class="fas fa-shopping-cart"></i>
                        Add to Cart
                    </button>
                    <button class="btn-wishlist" onclick="addToWishlist(${product.id})">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
    `;
    }

    // GENERATE STAR RATING
    function generateStars(rating) {
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        let stars = '';

        for (let i = 0; i < fullStars; i++) {
            stars += '<i class="fas fa-star"></i>';
        }

        if (hasHalfStar) {
            stars += '<i class="fas fa-star-half-alt"></i>';
        }

        const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
        for (let i = 0; i < emptyStars; i++) {
            stars += '<i class="far fa-star"></i>';
        }

        return stars;
    }

    // LOAD CATEGORIES
    async function loadCategories() {
        try {
            const response = await fetch('https://fakestoreapi.com/products/categories');
            const categories = await response.json();

            const container = document.querySelector('.category-grid');
            if (!container) return;

            const icons = ['fa-laptop', 'fa-tshirt', 'fa-gem', 'fa-mobile-alt'];

            container.innerHTML = categories.map((category, index) => `
            <a href="{% url 'products:product_list' %}?category=${category}" class="category-card">
                <div class="category-icon">
                    <i class="fas ${icons[index % icons.length]}"></i>
                </div>
                <h3 class="category-name">${capitalizeFirst(category)}</h3>
                <p class="category-count">View Products</p>
            </a>
        `).join('');
        } catch (error) {
            console.error('Error loading categories:', error);
        }
    }

    // ADD TO CART FUNCTION
    function addToCart(productId, productName) {
        console.log('Adding product to cart:', productId);
        showToast(`${productName} added to cart! üõí`, 'success');
    }

    // ADD TO WISHLIST FUNCTION
    function addToWishlist(productId) {
        console.log('Adding product to wishlist:', productId);
        showToast('Added to wishlist! ‚ù§Ô∏è', 'success');
    }

    // SHOW TOAST NOTIFICATION
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        <span>${message}</span>
    `;

        toast.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : '#ef4444'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        z-index: 9999;
        animation: slideInRight 0.3s ease;
    `;

        document.body.appendChild(toast);

        setTimeout(function () {
            toast.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(function () {
                toast.remove();
            }, 300);
        }, 3000);
    }

    // UTILITY FUNCTIONS
    function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // SMOOTH SCROLL TO FEATURED SECTION
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // LOAD PRODUCTS ON PAGE LOAD
    document.addEventListener('DOMContentLoaded', function () {
        console.log('Loading products from FakeStore API...');
        loadProductsFromAPI();
    });
</script>
{% endblock %}